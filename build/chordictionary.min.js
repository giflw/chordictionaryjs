/*!Chordictionary v0.4.0-beta, @license MIT, (c) 2016 Hubert Fauconnier + contributors*/
!function(a){"use strict";function b(){function e(a,c,d){for(var e,f,g={},h=0;h<a.length;h++)if(!isNaN(a[h])){f=a[h]+b.indexOf(d[h]),f>b.length-1&&(f-=b.length);for(var i=0;i<c.length;i++)g[b[f]]?b[f]==b[i]&&g[b[f]]++:g[b[f]]=1}for(var i=0;i<c.length;i++){if(!(c[i]in g)){e=!1;break}e=!0}return e}function f(b,c){var c=c||"EADGBE",d=[];try{if(b.length<=c.length)return b.split("");if(b.length==2*c.length){for(var e=0;e<b.length;e++)e%2||d.push(b.slice(e,e+2));return d}if(b.length>c.length){if(l(b.split(""),"max")>1){for(var e=0;e<b.length;e++)-1!=b.charAt(e).search(/[x02-9]/i)||1==b.charAt(e)&&-1!=b.charAt(e+1).search(/x/i)?d.push(b.slice(e,e+1)):-1==b.charAt(e+1).search(/x/i)&&(d.push(b.slice(e,e+2)),e++);return d}throw a.invalidTab}}catch(f){return!1}}function g(b){var c=[],d=new RegExp("^[a-g]+$","i"),e=new RegExp("^[#a-g]+$","i");try{if(d.test(b))return b.toUpperCase().split("");if(e.test(b)){b=b.toUpperCase();for(var f=0;f<b.length;f++)"#"!=b.charAt(f)&&("#"!=b.charAt(f+1)?c.push(b.slice(f,f+1)):(c.push(b.slice(f,f+2)),f++));return c}throw a.invalidTuning}catch(g){return!1}}function h(b){var c,d;try{if("string"!=typeof b)throw a.invalidChordName;var e=b.search("#");return-1==e?(c=b.charAt(0),d=b.slice(1)):(c=b.slice(0,2).toUpperCase(),d=b.slice(2)),[c,d]}catch(f){return!1}}function j(a){try{if(!Array.isArray(a))throw a+" is not an array.";var a=a;return a.filter(function(a,b,c){return b==c.indexOf(a)})}catch(b){return!1}}function k(a,b){try{if("object"==typeof a){var a=a;if("string"==typeof b)var b=b.toLowerCase();for(var c=0;c<a.length;c++)for(var d in a[c]){if(a[c][d]==b)return a[c];if("string"==typeof a[c][d]&&a[c][d].toLowerCase()==b)return a[c]}throw"Couldn't find "+b+" in "+a}throw a+" is not an object."}catch(e){return!1}}function l(a,b){var c;try{if(!Array.isArray(a))throw a+" is not an array.";var a=a;if(!b)throw"Missing parameter.";var b=b;switch(b){case"min":if(c=Math.min.apply(Math,a),!isNaN(c))return c;for(var d=0;d<a.length;d++)isNaN(a[d])||(isNaN(c)?c=a[d]:a[d]<c&&(c=a[d]));break;case"max":if(c=Math.max.apply(Math,a),!isNaN(c))return c;for(var d=0;d<a.length;d++)isNaN(a[d])||(isNaN(c)?c=a[d]:a[d]>c&&(c=a[d]));break;default:c=m(a.join(""),b)}}catch(e){return!1}return c}function m(a,b,c){if(a+="",b+="",b.length<=0)return a.length+1;for(var d=0,e=0,f=c?1:b.length;;){if(e=a.indexOf(b,e),!(e>=0))break;++d,e+=f}return d}var a={croppedChordLayout:"Number of frets does not allow full display of the chord.",failedToConvertTabIntoNotes:"Could not convert the tab into notes.",failedToCalculateFormula:"Could not calculate the formulas.",invalidTab:'The tab should only be composed of "x" and numbers from 1 to 9.',invalidTuning:"The tuning doesn't seem right. It should only be composed of 1 or more letters from A to G.",invalidChordName:"The chord name doesn't seem right. A valid chord name could be Amin, C, Gsus4...",noMatch:"The tab didn't match any known chord."},b=["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"],c=[{formula:"1-3-5",integer:"0-4-7",name:"Major",suffix:""},{formula:"1-5",integer:"0-7",name:"Power chord",suffix:"5"},{formula:"1-4-5",integer:"0-5-7",name:"Suspended fourth",suffix:"sus4"},{formula:"1-2-5",integer:"0-2-7",name:"Suspended second",suffix:"sus2"},{formula:"1-3-5-9",integer:"0-4-7-14",name:"Added ninth",suffix:"add9"},{formula:"1-3-5-6",integer:"0-4-7-9",name:"Major Sixth",suffix:"6"},{formula:"1-3-5-6-9",integer:"0-4-7-9-14",name:"Sixth, added ninth",suffix:"6/9"},{formula:"1-3-5-7",integer:"0-4-7-11",name:"Major seventh",suffix:"maj7"},{formula:"1-3-5-7-9",integer:"0-4-7-11-14",name:"Major ninth",suffix:"maj9"},{formula:"1-3-5-7-#11",integer:"0-4-7-11-18",name:"Major seventh, sharp eleventh",suffix:"maj7#11"},{formula:"1-3-5-7-9-13",integer:"0-4-7-11-14-21",name:"Major thirteen",suffix:"Maj13"},{formula:"1-b3-5",integer:"0-3-7",name:"Minor",suffix:"min"},{formula:"1-b3-5-9",integer:"0-3-7-14",name:"Minor, added ninth",suffix:"m(add9)"},{formula:"1-b3-5-6",integer:"0-3-7-9",name:"Minor sixth",suffix:"m6"},{formula:"1-b3-5-b6",integer:"0-3-7-8",name:"Minor, flat sixth",suffix:"mb6"},{formula:"1-b3-5-6-9",integer:"0-3-7-9-14",name:"Minor sixth, added ninth",suffix:"m6/9"},{formula:"1-b3-5-b7",integer:"0-3-7-10",name:"Minor seventh",suffix:"m7"},{formula:"1-b3-5-7",integer:"0-3-7-11",name:"Minor, major seventh",suffix:"m(maj7)"},{formula:"1-b3-5-b7",integer:"0-3-6-10",name:"Minor seventh, flat fifth",suffix:"m7b5"},{formula:"1-b3-5-b7-9",integer:"0-3-7-10-14",name:"Minor ninth",suffix:"m9"},{formula:"1-b3-5-7-9",integer:"0-3-7-11-14",name:"Minor ninth, major seventh",suffix:"m9(maj7)"},{formula:"1-b3-b5-b7-9",integer:"0-3-7-10-14",name:"Minor eleventh",suffix:"m9b5"},{formula:"1-b3-5-b7-9-11-13",integer:"0-3-7-10-14-17-21",name:"Minor thirteen",suffix:"m13"},{formula:"1-3-5-b7",integer:"0-4-7-10",name:"Dominant seventh",suffix:"7"},{formula:"1-3-5#",integer:"0-4-8",name:"Augmented",suffix:"aug"},{formula:"1-3-b5",integer:"0-4-6",name:"Diminished",suffix:"dim"},{formula:"1",integer:"0",name:"Single note",suffix:""},{formula:"1-3-b7",integer:"0-4-10",name:"Seventh",suffix:"7"},{formula:"1-3-6",integer:"0-4-9",name:"Sixth",suffix:"6"}],d={};return d.Instrument=function(a,b,c,e){try{d.isValidTuning(a)&&(this.tuning=g(a)),this.fretNumber=b,this.fretsToDisplay=isNaN(c)?0:c+1,this.maxSpan=isNaN(e)?5:e}catch(f){return console.error(f),!1}return this},d.Instrument.prototype.getChordInfo=function(e){var g=[],h=[],i=[],k={error:"",name:"",tab:e,notes:"",tuning:this.tuning.join(""),formula:""};try{if(d.isValidTab(e)){var e=f(e);k.tab=e.join(" ")}}catch(l){return k.error=l,k}var m,n;try{for(var o=0;o<e.length;o++)isNaN(e[o])?g.push("x"):(n=this.tuning[o],m=parseInt(e[o])+b.indexOf(n),m>b.length-1&&(m-=b.length),g.push(b[m]));k.notes=g.join("")}catch(l){return k.error=a.failedToConvertTabIntoNotes,k}var p=[];try{for(var o=0;o<this.tuning.length;o++)if(p.push({root:"",formula:[]}),g[o]&&"x"!=g[o])for(var q=0;q<g.length;q++)if(g[q]&&"x"!=g[q]){var r=b.indexOf(g[q])-b.indexOf(g[o]);0>r?r=b.length+r:0==r&&(p[o].root=g[q]),p[o].formula.push(r)}}catch(l){k.error=a.failedToCalculateFormula}for(var o=0;o<p.length;o++)if(""!=p[o].root){i.push(p[o].root),p[o].formula.sort(function(a,b){return a-b});var s=j(p[o].formula);h.push(s.join("-"))}var t,v,u=[],w=[];try{for(var o=0;o<c.length;o++){t=c[o].integer;for(var q=0;q<h.length;q++)v=new RegExp("^"+h[q]+"$","g"),t.match(v)&&i[q]&&(w.push(i[q]+c[o].suffix),u.push(c[o].formula))}if(!(u.length>0))throw a.noMatch;if(u.length>1){var x=j(u);k.formula=x}else k.formula=u}catch(l){return k.error=l,k}if(w.length>1){var y=j(w);k.name=y}else k.name=w;return k},d.Instrument.prototype.getChordsList=function(d,f,g){var i=[],g=g||0,j={error:"",chordList:[],offset:0};try{if("string"!=typeof d)throw a.invalidChordName;var d=h(d),m=d[0],n=d[1];i.push(m)}catch(o){return j.error=o,j}try{var p=k(c,n),q=p.integer.split("-")}catch(o){return j.error=o,j}for(var r=1;r<q.length;r++){var s=parseInt(q[r])+parseInt(b.indexOf(m));s>b.length-1&&(s-=b.length),i.push(b[s])}for(var u,t=[],v=0;v<this.tuning.length;v++){t[v]=[],t[v].push("x");for(var w=0;w<i.length;w++)u=b.indexOf(i[w])-b.indexOf(this.tuning[v]),0>u&&(u=b.length+u),t[v].push(u),u+12<this.fretNumber&&t[v].push(u+12)}for(var x=[],v=0;v<this.tuning.length;v++)for(var y=x.length,r=0;r<t[v].length;r++)if(x[r])for(var z=0;y>z;z++)if(0===r)x[z].push(t[v][r]);else{var A=x[z].slice(0);A.pop(),A.push(t[v][r]),x.push(A)}else x[r]=[t[v][r]];for(var B=[],C=g;C<x.length;C++)if(e(x[C],i,this.tuning)&&l(x[C],"max")-l(x[C],"min")<this.maxSpan){for(var r=0;r<x[C].length;r++)if(!isNaN(x[C][r])){var D=x[C][r]+b.indexOf(this.tuning[r]);if(x[C][r]<=4&&b.indexOf(m)==D&&x[C].lastIndexOf("x")<r){B.push(x[C]);break}break}if(f>0&&f<x[C].length&&B.length>=f){g=C+1;break}}return j.chordList=B,j.offset=g,j},d.Instrument.prototype.getChordLayout=function(b,c){var e,g,h=this.fretsToDisplay;try{if(d.isValidTab(c))var e=f(c);else var e=[0,0,0,0,0,0]}catch(i){return!1}for(var j=[],k=0;k<e.length;k++)isNaN(e[k])===!1&&j.push(e[k]);var l=Math.abs(Math.max.apply(Math,j)),m=Math.abs(Math.min.apply(Math,j)),n=1;l>=h&&(n=m>0?m:1),1===n&&l>5&&(n=l-h+2),0===h?h=l-n+2:l-n+1>h-1&&(console.error(a.croppedChordLayout),h=l-n+2),g='<table class="chord">';for(var o=0;h>o;o++){var p=o+n-1;1==n&&0==o&&(g+="<thead>"),g+=p%2&&p>0?'<tr><th class="fret-number">'+p+"</th>":"<tr><th></th>";for(var q=0;q<this.tuning.length;q++)g+=0==o?0==e[q]?'<th><div class="dot open"></div></th>':"<th></th>":e[q]==n+o-1?'<td><div class="dot plain">'+e[q]+"</div></td>":"<td></td>";g+=1==n&&0==o?"<tr></thead>":"</tr>"}return g+='<caption align="bottom">'+b+"</caption>",g+="</table>",console.log(e+" => base: "+n+" => highest fret: "+l),g},d.isValidTab=function(b){var c=new RegExp("^[x0-9]*$","i");if(c.test(b))return!0;throw a.invalidTab},d.isValidTuning=function(b){var b=b,c=new RegExp("^[#a-g]+$","i");if(c.test(b))return!0;throw a.invalidTuning},d}"undefined"==typeof Chordictionary?a.Chordictionary=b():console.error()}(window);
